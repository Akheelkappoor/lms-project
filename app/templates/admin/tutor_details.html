{% extends "base.html" %}

{% block title %}{{ tutor.user.full_name }} - Tutor Details{% endblock %}

{% block extra_css %}
<style>
    /* Fix main layout - remove the gap issue */
    .main-content {
        margin-left: var(--sidebar-width) !important;
        width: calc(100% - var(--sidebar-width)) !important;
        padding: 0 !important;
        background: var(--bg-light);
        min-height: 100vh;
    }

    @media (max-width: 1024px) {
        .main-content {
            margin-left: 0 !important;
            width: 100% !important;
        }
    }
    
    /* Page Header - Fixed styling */
    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #e8974a 100%);
        color: white;
        padding: 2rem;
        margin: 0;
        border: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .page-header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .page-title h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .page-title p {
        margin: 0.5rem 0 0 0;
        opacity: 0.9;
        font-size: 1rem;
    }

    .page-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .page-actions .btn {
        background: rgba(255,255,255,0.15);
        border: 1px solid rgba(255,255,255,0.3);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .page-actions .btn:hover {
        background: rgba(255,255,255,0.25);
        transform: translateY(-2px);
        color: white;
    }

    .page-actions .btn-primary {
        background: rgba(255,255,255,0.9);
        color: var(--primary-color);
        font-weight: 600;
    }

    .page-actions .btn-primary:hover {
        background: white;
        color: var(--primary-dark);
    }
    
    /* Content Container - Fixed spacing */
    .content-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .details-container {
        background: var(--bg-white);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: 1px solid var(--border-color);
    }
    
    /* Profile Header */
    .profile-header {
        background: var(--bg-white);
        padding: 2rem;
        display: flex;
        align-items: center;
        gap: 2rem;
        border-bottom: 1px solid var(--border-color);
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid var(--border-color);
        object-fit: cover;
        background: var(--bg-light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: var(--text-muted);
        flex-shrink: 0;
    }
    
    .profile-info {
        flex: 1;
    }
    
    .profile-info h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .profile-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
    
    .status-badges {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }
    
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: var(--border-radius);
        font-size: 0.875rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .status-badge.active {
        background: rgba(40, 167, 69, 0.1);
        color: var(--success-color);
    }
    
    .status-badge.pending {
        background: rgba(255, 193, 7, 0.1);
        color: var(--warning-color);
    }
    
    .status-badge.inactive {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger-color);
    }
    
    .status-badge.verified {
        background: rgba(23, 162, 184, 0.1);
        color: var(--info-color);
    }
    
    .status-badge.rejected {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger-color);
    }
    
    /* Grid Layout - Fixed */
    .details-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 0;
    }
    
    .main-details {
        border-right: 1px solid var(--border-color);
    }
    
    .sidebar-details {
        background: var(--bg-light);
    }
    
    /* Sections */
    .details-section {
        padding: 2rem;
        border-bottom: 1px solid var(--border-color);
        background: var(--bg-white);
    }

    .sidebar-details .details-section {
        background: var(--bg-light);
    }
    
    .details-section:last-child {
        border-bottom: none;
    }
    
    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-title .btn {
        margin-left: auto;
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
    }
    
    /* Info Grid */
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .info-grid:last-child {
        margin-bottom: 0;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .info-label {
        font-size: 0.875rem;
        color: var(--text-muted);
        font-weight: 500;
    }
    
    .info-value {
        color: var(--text-primary);
        font-weight: 500;
    }
    
    /* Tags */
    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    
    .tag {
        background: var(--primary-light);
        color: var(--primary-dark);
        padding: 0.25rem 0.75rem;
        border-radius: var(--border-radius);
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    /* Documents Grid - Fixed */
    .documents-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .document-item {
        background: var(--bg-light);
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        text-align: center;
        transition: var(--transition);
        position: relative;
    }
    
    .document-item:hover {
        border-color: var(--primary-color);
        background: rgba(241, 161, 80, 0.05);
        transform: translateY(-2px);
    }

    .document-item.available {
        border-color: var(--success-color);
        background: rgba(40, 167, 69, 0.05);
    }

    .document-item.missing {
        border-color: var(--danger-color);
        background: rgba(220, 53, 69, 0.05);
    }
    
    .document-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }

    .document-item.available .document-icon {
        color: var(--success-color);
    }

    .document-item.missing .document-icon {
        color: var(--danger-color);
    }
    
    .document-name {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }
    
    .document-status {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
    }

    .document-status .btn {
        font-size: 0.75rem;
        padding: 0.35rem 0.75rem;
        margin: 0.1rem;
        border-radius: 6px;
    }
    
    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .stat-item {
        text-align: center;
        padding: 1.5rem;
        background: var(--bg-white);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-color);
        display: block;
    }
    
    .stat-label {
        font-size: 0.875rem;
        color: var(--text-muted);
        margin-top: 0.5rem;
    }
    
    /* Classes List */
    .classes-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .class-item {
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    
    .class-item:last-child {
        border-bottom: none;
    }
    
    /* Dynamic Actions */
    .dynamic-actions {
        background: var(--bg-white);
        padding: 2rem;
        border-top: 1px solid var(--border-color);
    }
    
    .action-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--border-color);
    }
    
    .action-section:last-child {
        margin-bottom: 0;
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .action-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .verification-panel {
        background: var(--bg-light);
        border: 2px solid var(--warning-color);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
    }
    
    .verification-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    /* Modal Styling */
    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 0.375rem 0.375rem 0 0;
    }

    .modal-header .btn-close {
        filter: invert(1);
    }

    .modal-body {
        padding: 1.5rem;
    }

    .form-text {
        color: var(--text-muted);
        font-size: 0.775rem;
    }

    /* Badge Styling */
    .badge {
        padding: 0.25rem 0.5rem;
        border-radius: var(--border-radius);
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .badge-success {
        background-color: var(--success-color);
        color: white;
    }
    
    .badge-warning {
        background-color: var(--warning-color);
        color: #856404;
    }
    
    .badge-secondary {
        background-color: var(--secondary-color);
        color: white;
    }
    
    .text-muted {
        color: var(--text-muted);
    }
    
    /* Loading states */
    .btn:disabled {
        opacity: 0.6;
        pointer-events: none;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .content-container {
            padding: 1rem;
        }

        .details-grid {
            grid-template-columns: 1fr;
        }
        
        .main-details {
            border-right: none;
            border-bottom: 1px solid var(--border-color);
        }
        
        .profile-header {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
            padding: 1.5rem;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .documents-grid {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1rem;
        }

        .document-item {
            padding: 1rem;
        }

        .page-header-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        .page-actions {
            align-self: stretch;
        }

        .page-actions .btn {
            flex: 1;
            justify-content: center;
        }

        .section-title {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .section-title .btn {
            margin-left: 0;
            align-self: stretch;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <div class="page-title">
            <h1><i class="fas fa-chalkboard-teacher"></i> Tutor Details</h1>
            <p>Complete tutor profile and management</p>
        </div>
        <div class="page-actions">
            <a href="{{ url_for('admin.tutors') }}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Tutors
            </a>
            
            <!-- Edit User Account Button -->
            <a href="{{ url_for('admin.edit_user', user_id=tutor.user.id) }}" class="btn btn-secondary">
                <i class="fas fa-user-edit"></i> Edit User Account
            </a>
            
            <!-- Edit Tutor Profile Button with Access Control -->
            {% if current_user.role in ['superadmin', 'admin'] or 
                  (current_user.role == 'coordinator' and current_user.department_id == tutor.user.department_id) %}
                <a href="{{ url_for('admin.edit_tutor', tutor_id=tutor.id) }}" class="btn btn-primary">
                    <i class="fas fa-chalkboard-teacher"></i> Edit Tutor Profile
                </a>
            {% endif %}
            
            <!-- Actions Dropdown -->
            {% if current_user.role in ['superadmin', 'admin'] %}
            <div class="btn-group">
                <button type="button" class="btn btn-info dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fas fa-cog"></i> Actions
                </button>
                <ul class="dropdown-menu">
                    {% if tutor.verification_status == 'pending' %}
                    <li><a class="dropdown-item" href="#" onclick="handleVerification('approve')">
                        <i class="fas fa-check-circle text-success"></i> Approve Tutor
                    </a></li>
                    <li><a class="dropdown-item" href="#" onclick="handleVerification('reject')">
                        <i class="fas fa-times-circle text-danger"></i> Reject Tutor
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    {% endif %}
                    <li><a class="dropdown-item" href="#" onclick="handleAccountStatus('{{ 'activate' if not tutor.user.is_active else 'deactivate' }}')">
                        <i class="fas fa-{{ 'play' if not tutor.user.is_active else 'pause' }} text-warning"></i> 
                        {{ 'Activate' if not tutor.user.is_active else 'Deactivate' }} Account
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('admin.classes', tutor_id=tutor.id) }}">
                        <i class="fas fa-calendar text-info"></i> View Classes
                    </a></li>
                    {% if current_user.role == 'superadmin' %}
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="#" onclick="handleDelete()">
                        <i class="fas fa-trash"></i> Delete Tutor
                    </a></li>
                    {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="content-container">
    <div class="details-container">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-avatar">
                {% if tutor.user.profile_picture %}
                    <img src="{{ tutor.user.profile_picture }}" 
                         alt="Profile Picture" class="profile-avatar">
                {% else %}
                    <i class="fas fa-user"></i>
                {% endif %}
            </div>
            
            <div class="profile-info">
                <h1>{{ tutor.user.full_name }}</h1>
                <div class="profile-meta">
                    <div class="meta-item">
                        <i class="fas fa-envelope"></i>
                        {{ tutor.user.email }}
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-phone"></i>
                        {{ tutor.user.phone or 'Not provided' }}
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-building"></i>
                        {{ tutor.user.department.name if tutor.user.department else 'No Department' }}
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-calendar"></i>
                        Joined {{ tutor.created_at.strftime('%d %b %Y') if tutor.created_at else 'Unknown' }}
                    </div>
                </div>
                
                <div class="status-badges">
                    <div class="status-badge {% if tutor.status == 'active' %}active{% elif tutor.status == 'pending' %}pending{% else %}inactive{% endif %}">
                        <i class="fas fa-circle"></i>
                        {{ tutor.status.title() }}
                    </div>
                    <div class="status-badge {% if tutor.verification_status == 'verified' %}verified{% elif tutor.verification_status == 'pending' %}pending{% elif tutor.verification_status == 'rejected' %}rejected{% else %}inactive{% endif %}">
                        <i class="fas fa-shield-alt"></i>
                        {{ tutor.verification_status.title() }}
                    </div>
                    {% if tutor.user.is_active %}
                        <div class="status-badge active">
                            <i class="fas fa-user-check"></i>
                            Account Active
                        </div>
                    {% else %}
                        <div class="status-badge inactive">
                            <i class="fas fa-user-times"></i>
                            Account Inactive
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="details-grid">
            <!-- Main Content -->
            <div class="main-details">
                <!-- Professional Information -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        Professional Information
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Qualification</span>
                            <span class="info-value">{{ tutor.qualification or 'Not specified' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Experience</span>
                            <span class="info-value">{{ tutor.experience if tutor.experience else 'Not specified' }}</span>
                        </div>
                    </div>
                    
                    <!-- Test Score Information -->
                    {% if tutor.test_score is not none %}
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Test Score</span>
                            <span class="info-value">
                                {{ tutor.test_score }}/100 
                                <span class="badge badge-{{ 'success' if tutor.test_score >= 80 else 'warning' if tutor.test_score >= 60 else 'danger' }}">
                                    {{ tutor.get_test_score_grade() }}
                                </span>
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Test Date</span>
                            <span class="info-value">
                                {{ tutor.test_date.strftime('%d %b %Y') if tutor.test_date else 'Not specified' }}
                            </span>
                        </div>
                    </div>
                    {% if tutor.test_notes %}
                    <div class="info-item">
                        <span class="info-label">Test Notes</span>
                        <span class="info-value">{{ tutor.test_notes }}</span>
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Subjects</span>
                            <div class="tags-container">
                                {% for subject in tutor.get_subjects() %}
                                    <span class="tag">{{ subject }}</span>
                                {% else %}
                                    <span class="text-muted">No subjects specified</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Grades</span>
                            <div class="tags-container">
                                {% for grade in tutor.get_grades() %}
                                    <span class="tag">Grade {{ grade }}</span>
                                {% else %}
                                    <span class="text-muted">No grades specified</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Education Boards</span>
                            <div class="tags-container">
                                {% for board in tutor.get_boards() %}
                                    <span class="tag">{{ board }}</span>
                                {% else %}
                                    <span class="text-muted">No boards specified</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Compensation</span>
                            <span class="info-value">
                                {% if tutor.salary_type == 'monthly' and tutor.monthly_salary is not none %}
                                    ₹{{ "{:,.0f}".format(tutor.monthly_salary) }}/month
                                {% elif tutor.salary_type == 'hourly' and tutor.hourly_rate is not none %}
                                    ₹{{ "{:,.0f}".format(tutor.hourly_rate) }}/hour
                                {% else %}
                                    Not specified
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Documents & Media -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Documents & Media
                        {% if current_user.role in ['superadmin', 'admin'] %}
                            <button class="btn btn-sm btn-primary" onclick="showUploadModal()">
                                <i class="fas fa-upload"></i> Upload Document
                            </button>
                        {% endif %}
                    </div>
                    
                    <div class="documents-grid">
                        {% set documents = tutor.get_documents() %}
                        
                        <!-- Aadhaar Card -->
                        <div class="document-item {% if documents.get('aadhaar') %}available{% else %}missing{% endif %}" id="doc-aadhaar">
                            <div class="document-icon">
                                <i class="fas fa-id-card"></i>
                            </div>
                            <div class="document-name">Aadhaar Card</div>
                            <div class="document-status">
                                {% if documents.get('aadhaar') %}
                                    {% set doc_info = documents.aadhaar %}
                                    {% if doc_info %}
                                        {% if doc_info is mapping %}
                                            {% set filename = doc_info.filename %}
                                        {% else %}
                                            {% set filename = doc_info %}
                                        {% endif %}
                                        {% if filename.startswith('https') %}
                                            <a href="{{ filename }}" target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                                <i class="fas fa-eye"></i> View
                                            </a>
                                        {% else %}
                                            <a href="{{ documents.aadhaar }}" 
                                               target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                                <i class="fas fa-eye"></i> View
                                            </a>
                                        {% endif %}
                                        {% if current_user.role in ['superadmin', 'admin'] %}
                                            <button class="btn btn-sm btn-warning" onclick="replaceDocument('aadhaar')">
                                                <i class="fas fa-edit"></i> Replace
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteDocument('aadhaar')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadDocument('aadhaar')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- PAN Card -->
                        <div class="document-item {% if documents.get('pan') %}available{% else %}missing{% endif %}" id="doc-pan">
                            <div class="document-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="document-name">PAN Card</div>
                            <div class="document-status">
                                {% if documents.get('pan') %}
                                    {% set doc_info = documents.pan %}
                                    {% if doc_info %}
                                        {% if doc_info is mapping %}
                                            {% set filename = doc_info.filename %}
                                        {% else %}
                                            {% set filename = doc_info %}
                                        {% endif %}
                                        <a href="{{ documents.pan }}" 
                                           target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                        {% if current_user.role in ['superadmin', 'admin'] %}
                                            <button class="btn btn-sm btn-warning" onclick="replaceDocument('pan')">
                                                <i class="fas fa-edit"></i> Replace
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteDocument('pan')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadDocument('pan')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Resume -->
                        <div class="document-item {% if documents.get('resume') %}available{% else %}missing{% endif %}" id="doc-resume">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="document-name">Resume</div>
                            <div class="document-status">
                                {% if documents.get('resume') %}
                                    {% set doc_info = documents.resume %}
                                    {% if doc_info %}
                                        {% if doc_info is mapping %}
                                            {% set filename = doc_info.filename %}
                                        {% else %}
                                            {% set filename = doc_info %}
                                        {% endif %}
                                        <a href="{{ documents.resume }}" 
                                           target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                            <i class="fas fa-download"></i> Download
                                        </a>
                                        {% if current_user.role in ['superadmin', 'admin'] %}
                                            <button class="btn btn-sm btn-warning" onclick="replaceDocument('resume')">
                                                <i class="fas fa-edit"></i> Replace
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteDocument('resume')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadDocument('resume')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Degree Certificate -->
                        <div class="document-item {% if documents.get('degree') %}available{% else %}missing{% endif %}" id="doc-degree">
                            <div class="document-icon">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div class="document-name">Degree Certificate</div>
                            <div class="document-status">
                                {% if documents.get('degree') %}
                                    {% set doc_info = documents.degree %}
                                    {% if doc_info %}
                                        {% if doc_info is mapping %}
                                            {% set filename = doc_info.filename %}
                                        {% else %}
                                            {% set filename = doc_info %}
                                        {% endif %}
                                        <a href="{{ documents.degree }}" 
                                           target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                            <i class="fas fa-eye"></i> View
                                        </a>
                                        {% if current_user.role in ['superadmin', 'admin'] %}
                                            <button class="btn btn-sm btn-warning" onclick="replaceDocument('degree')">
                                                <i class="fas fa-edit"></i> Replace
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteDocument('degree')">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        {% endif %}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadDocument('degree')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Demo Video -->
                        <div class="document-item {% if tutor.demo_video %}available{% else %}missing{% endif %}" id="doc-demo-video">
                            <div class="document-icon">
                                <i class="fas fa-play-circle"></i>
                            </div>
                            <div class="document-name">Demo Video</div>
                            <div class="document-status">
                                {% if tutor.demo_video %}
                                    {% if tutor.demo_video.startswith('https') %}
                                        <a href="{{ tutor.demo_video }}" target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                            <i class="fas fa-play"></i> Watch
                                        </a>
                                    {% endif %}
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-warning" onclick="uploadVideo('demo')">
                                            <i class="fas fa-edit"></i> Replace
                                        </button>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadVideo('demo')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Interview Video -->
                        <div class="document-item {% if tutor.interview_video %}available{% else %}missing{% endif %}" id="doc-interview-video">
                            <div class="document-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="document-name">Interview Video</div>
                            <div class="document-status">
                                {% if tutor.interview_video %}
                                    {% if tutor.interview_video.startswith('https') %}
                                        <a href="{{ tutor.interview_video }}" target="_blank" rel="noopener" class="btn btn-sm btn-info">
                                            <i class="fas fa-play"></i> Watch
                                        </a>
                                    {% endif %}
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-warning" onclick="uploadVideo('interview')">
                                            <i class="fas fa-edit"></i> Replace
                                        </button>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not uploaded</span>
                                    {% if current_user.role in ['superadmin', 'admin'] %}
                                        <button class="btn btn-sm btn-primary" onclick="uploadVideo('interview')">
                                            <i class="fas fa-upload"></i> Upload
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Banking Information -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-university"></i>
                        Banking Information
                    </div>
                    
                    {% set bank_details = tutor.get_bank_details() %}
                    {% if bank_details %}
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Account Holder</span>
                            <span class="info-value">{{ bank_details.get('account_holder_name', 'Not provided') }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Bank Name</span>
                            <span class="info-value">{{ bank_details.get('bank_name', 'Not provided') }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Branch</span>
                            <span class="info-value">{{ bank_details.get('branch_name', 'Not provided') }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Account Number</span>
                            <span class="info-value">
                                {% if bank_details.get('account_number') %}
                                    ****{{ bank_details.account_number[-4:] }}
                                {% else %}
                                    Not provided
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">IFSC Code</span>
                            <span class="info-value">{{ bank_details.get('ifsc_code', 'Not provided') }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Account Type</span>
                            <span class="info-value">{{ bank_details.get('account_type', 'Not specified').title() }}</span>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-muted">Banking information not provided</p>
                    {% endif %}
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar-details">
                <!-- Performance Stats -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Performance Stats
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value">{{ tutor.total_classes or 0 }}</span>
                            <span class="stat-label">Total Classes</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ tutor.completed_classes or 0 }}</span>
                            <span class="stat-label">Completed</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">{{ "%.1f"|format(tutor.rating or 0) }}</span>
                            <span class="stat-label">Rating</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">
                                {% if tutor.total_classes and tutor.total_classes > 0 %}
                                    {{ "%.0f"|format((tutor.completed_classes / tutor.total_classes) * 100) }}%
                                {% else %}
                                    0%
                                {% endif %}
                            </span>
                            <span class="stat-label">Completion Rate</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Classes -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-calendar"></i>
                        Recent Classes
                    </div>
                    
                    {% if classes %}
                    <div class="classes-list">
                        {% for class in classes[:5] %}
                        <div class="class-item">
                            <div style="font-weight: 500; margin-bottom: 0.25rem;">
                                {{ class.subject }} - Grade {{ class.grade }}
                            </div>
                            <div style="font-size: 0.875rem; color: var(--text-muted);">
                                {{ class.scheduled_date.strftime('%d %b %Y') }} at {{ class.scheduled_time.strftime('%I:%M %p') }}
                            </div>
                            <div style="margin-top: 0.25rem;">
                                <span class="badge badge-{{ 'success' if class.status == 'completed' else 'warning' if class.status == 'in_progress' else 'secondary' }}">
                                    {{ class.status.replace('_', ' ').title() }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    {% if classes|length > 5 %}
                    <div style="margin-top: 1rem; text-align: center;">
                        <a href="{{ url_for('admin.classes', tutor_id=tutor.id) }}" class="btn btn-outline btn-sm">
                            View All Classes
                        </a>
                    </div>
                    {% endif %}
                    {% else %}
                    <p class="text-muted">No classes found</p>
                    {% endif %}
                </div>

                <!-- Contact Information -->
                <div class="details-section">
                    <div class="section-title">
                        <i class="fas fa-address-card"></i>
                        Contact Information
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 1rem;">
                        <span class="info-label">Address</span>
                        <span class="info-value">{{ tutor.user.address or 'Not provided' }}</span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 1rem;">
                        <span class="info-label">State & PIN</span>
                        <span class="info-value">
                            {% if tutor.state or tutor.pin_code %}
                                {{ tutor.state or '' }}{{ ', ' if tutor.state and tutor.pin_code else '' }}{{ tutor.pin_code or '' }}
                            {% else %}
                                Not provided
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="info-item" style="margin-bottom: 1rem;">
                        <span class="info-label">Working Hours</span>
                        <span class="info-value">{{ tutor.user.working_hours or 'Not specified' }}</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">Last Login</span>
                        <span class="info-value">
                            {% if tutor.user.last_login %}
                                {{ tutor.user.last_login.strftime('%d %b %Y, %I:%M %p') }}
                            {% else %}
                                Never
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Action Panel -->
        {% if current_user.role in ['superadmin', 'admin'] %}
        <div class="dynamic-actions">
            <!-- Verification Actions -->
            {% if tutor.verification_status in ['pending', 'rejected'] %}
            <div class="action-section">
                <div class="action-title">
                    <i class="fas fa-shield-check"></i>
                    Verification Management
                </div>
                {% if tutor.verification_status == 'pending' %}
                <div class="verification-panel">
                    <h5><i class="fas fa-exclamation-triangle"></i> Verification Pending</h5>
                    <p>This tutor's profile is pending verification. Please review all documents and information before approving.</p>
                    <div class="verification-actions">
                        <button type="button" class="btn btn-success" onclick="handleVerification('approve')">
                            <i class="fas fa-check"></i> Approve & Activate
                        </button>
                        <button type="button" class="btn btn-danger" onclick="handleVerification('reject')">
                            <i class="fas fa-times"></i> Reject Verification
                        </button>
                    </div>
                </div>
                {% elif tutor.verification_status == 'rejected' %}
                <div class="verification-panel" style="border-color: var(--danger-color);">
                    <h5><i class="fas fa-times-circle"></i> Verification Rejected</h5>
                    <p>This tutor's verification was rejected. You can re-approve if issues have been resolved.</p>
                    <div class="verification-actions">
                        <button type="button" class="btn btn-success" onclick="handleVerification('approve')">
                            <i class="fas fa-check"></i> Approve Now
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Account Management -->
            <div class="action-section">
                <div class="action-title">
                    <i class="fas fa-user-cog"></i>
                    Account Management
                </div>
                <div class="action-buttons">
                    <a href="{{ url_for('admin.edit_user', user_id=tutor.user.id) }}" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Edit User Account
                    </a>
                    
                    {% if current_user.role in ['superadmin', 'admin'] or 
                          (current_user.role == 'coordinator' and current_user.department_id == tutor.user.department_id) %}
                    <a href="{{ url_for('admin.edit_tutor', tutor_id=tutor.id) }}" class="btn btn-secondary">
                        <i class="fas fa-chalkboard-teacher"></i> Edit Tutor Profile
                    </a>
                    {% endif %}
                    
                    {% if tutor.user.is_active %}
                        <button type="button" class="btn btn-warning" onclick="handleAccountStatus('deactivate')">
                            <i class="fas fa-pause"></i> Deactivate Account
                        </button>
                    {% else %}
                        <button type="button" class="btn btn-success" onclick="handleAccountStatus('activate')">
                            <i class="fas fa-play"></i> Activate Account
                        </button>
                    {% endif %}
                    
                    <a href="{{ url_for('admin.classes', tutor_id=tutor.id) }}" class="btn btn-outline">
                        <i class="fas fa-calendar"></i> View All Classes
                    </a>
                    
                    {% if current_user.role == 'superadmin' %}
                    <button type="button" class="btn btn-danger" onclick="handleDelete()">
                        <i class="fas fa-trash"></i> Delete Tutor
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Document Upload Modal -->
<div class="modal fade" id="documentUploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Upload Document</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="documentUploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="documentType" class="form-label">Document Type</label>
                        <select class="form-select" id="documentType" name="document_type" required>
                            <option value="">Select Document Type</option>
                            <option value="aadhaar">Aadhaar Card</option>
                            <option value="pan">PAN Card</option>
                            <option value="resume">Resume</option>
                            <option value="degree">Degree Certificate</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="documentFile" class="form-label">File</label>
                        <input type="file" class="form-control" id="documentFile" name="document" 
                               accept=".pdf,.jpg,.jpeg,.png" required>
                        <div class="form-text">Accepted formats: PDF, JPG, PNG (Max 10MB)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitDocumentUpload()">
                    <i class="fas fa-upload"></i> Upload
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Video Upload Modal -->
<div class="modal fade" id="videoUploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Upload Video</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="videoUploadForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="videoType" class="form-label">Video Type</label>
                        <select class="form-select" id="videoType" name="video_type" required>
                            <option value="">Select Video Type</option>
                            <option value="demo">Demo Video</option>
                            <option value="interview">Interview Video</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="videoFile" class="form-label">Video File</label>
                        <input type="file" class="form-control" id="videoFile" name="video" 
                               accept=".mp4,.avi,.mov,.wmv" required>
                        <div class="form-text">Accepted formats: MP4, AVI, MOV, WMV (Max 100MB)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitVideoUpload()">
                    <i class="fas fa-upload"></i> Upload
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Helper function to get CSRF token
    function getCSRFToken() {
        const metaTag = document.querySelector('meta[name=csrf-token]');
        if (metaTag && metaTag.getAttribute('content')) {
            return metaTag.getAttribute('content');
        }
        
        const hiddenInput = document.querySelector('input[name=csrf_token]');
        if (hiddenInput && hiddenInput.value) {
            return hiddenInput.value;
        }
        
        console.error('CSRF token not found');
        return null;
    }
    
    // Helper function to make authenticated requests
    function makeAuthenticatedRequest(url, options = {}) {
        const csrfToken = getCSRFToken();
        
        if (!csrfToken) {
            alert('Security token not found. Please refresh the page and try again.');
            return Promise.reject('CSRF token not found');
        }
        
        const defaultOptions = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            }
        };
        
        return fetch(url, { ...defaultOptions, ...options });
    }
    
    // Handle verification actions
    window.handleVerification = function(action) {
        const actionText = action === 'approve' ? 'approve and activate' : 'reject';
        
        if (!confirm(`Are you sure you want to ${actionText} this tutor?`)) {
            return;
        }
        
        makeAuthenticatedRequest(`{{ url_for('admin.verify_tutor', tutor_id=tutor.id) }}`, {
            body: JSON.stringify({ action: action })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Tutor verification ${action}d successfully!`);
                location.reload();
            } else {
                alert(data.error || 'An error occurred');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please check the console for details.');
        });
    };
    
    // Handle account status changes
    window.handleAccountStatus = function(action) {
        const actionText = action === 'activate' ? 'activate' : 'deactivate';
        
        if (!confirm(`Are you sure you want to ${actionText} this tutor's account?`)) {
            return;
        }
        
        makeAuthenticatedRequest(`{{ url_for('admin.toggle_user_status', user_id=tutor.user.id) }}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Account ${actionText}d successfully!`);
                location.reload();
            } else {
                alert(data.error || 'An error occurred');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please check the console for details.');
        });
    };
    
    // Handle deletion
    window.handleDelete = function() {
        if (!confirm('Are you sure you want to delete this tutor? This action cannot be undone.')) {
            return;
        }
        
        const secondConfirm = prompt('Type "DELETE" to confirm:', '');
        if (secondConfirm !== 'DELETE') {
            alert('Deletion cancelled.');
            return;
        }
        
        makeAuthenticatedRequest(`{{ url_for('admin.delete_user', user_id=tutor.user.id) }}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Tutor deleted successfully!');
                window.location.href = "{{ url_for('admin.tutors') }}";
            } else {
                alert(data.error || 'An error occurred');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please check the console for details.');
        });
    };

    // Document management functions
    window.showUploadModal = function() {
        const modal = new bootstrap.Modal(document.getElementById('documentUploadModal'));
        modal.show();
    };

    window.uploadDocument = function(documentType) {
        document.getElementById('documentType').value = documentType;
        showUploadModal();
    };

    window.replaceDocument = function(documentType) {
        uploadDocument(documentType);
    };

    window.uploadVideo = function(videoType) {
        document.getElementById('videoType').value = videoType;
        const modal = new bootstrap.Modal(document.getElementById('videoUploadModal'));
        modal.show();
    };

    window.submitDocumentUpload = function() {
        const form = document.getElementById('documentUploadForm');
        const formData = new FormData(form);
        const submitButton = event.target;
        const originalText = submitButton.innerHTML;
        
        // Show loading state
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        
        fetch(`{{ url_for('admin.upload_tutor_document', tutor_id=tutor.id) }}`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCSRFToken()
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message
                showAlert(data.message, 'success');
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('documentUploadModal')).hide();
                
                // Reload page to show updated documents
                setTimeout(() => window.location.reload(), 1500);
            } else {
                showAlert(data.error || 'Upload failed', 'error');
            }
        })
        .catch(error => {
            console.error('Upload error:', error);
            showAlert('Network error occurred during upload', 'error');
        })
        .finally(() => {
            // Reset button
            submitButton.disabled = false;
            submitButton.innerHTML = originalText;
        });
    };

    window.submitVideoUpload = function() {
        const form = document.getElementById('videoUploadForm');
        const formData = new FormData(form);
        const submitButton = event.target;
        const originalText = submitButton.innerHTML;
        
        // Show loading state
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        
        fetch(`{{ url_for('admin.upload_tutor_video', tutor_id=tutor.id) }}`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCSRFToken()
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message
                showAlert(data.message, 'success');
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('videoUploadModal')).hide();
                
                // Reload page to show updated videos
                setTimeout(() => window.location.reload(), 1500);
            } else {
                showAlert(data.error || 'Upload failed', 'error');
            }
        })
        .catch(error => {
            console.error('Upload error:', error);
            showAlert('Network error occurred during upload', 'error');
        })
        .finally(() => {
            // Reset button
            submitButton.disabled = false;
            submitButton.innerHTML = originalText;
        });
    };

    window.deleteDocument = function(documentType) {
        if (!confirm(`Are you sure you want to delete the ${documentType} document? This action cannot be undone.`)) {
            return;
        }
        
        fetch(`{{ url_for('admin.delete_tutor_document', tutor_id=tutor.id, document_type='') }}${documentType}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert(data.message, 'success');
                
                // Update the document item to show "not uploaded"
                const docItem = document.getElementById(`doc-${documentType}`);
                if (docItem) {
                    docItem.className = 'document-item missing';
                    const statusDiv = docItem.querySelector('.document-status');
                    statusDiv.innerHTML = `
                        <span class="text-muted">Not uploaded</span>
                        <button class="btn btn-sm btn-primary" onclick="uploadDocument('${documentType}')">
                            <i class="fas fa-upload"></i> Upload
                        </button>
                    `;
                }
            } else {
                showAlert(data.error || 'Delete failed', 'error');
            }
        })
        .catch(error => {
            console.error('Delete error:', error);
            showAlert('Network error occurred during deletion', 'error');
        });
    };

    // Helper function to show alerts
    window.showAlert = function(message, type) {
        // You can customize this based on your alert system
        if (window.LMS && window.LMS.showAlert) {
            LMS.showAlert(message, type);
        } else {
            alert(message);
        }
    };

    // File validation
    document.getElementById('documentFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Check file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB');
                e.target.value = '';
                return;
            }
            
            // Check file type
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            if (!allowedTypes.includes(file.type)) {
                alert('Only PDF, JPG, and PNG files are allowed');
                e.target.value = '';
                return;
            }
        }
    });

    document.getElementById('videoFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Check file size (100MB limit)
            if (file.size > 100 * 1024 * 1024) {
                alert('Video file size must be less than 100MB');
                e.target.value = '';
                return;
            }
            
            // Check file type
            const allowedTypes = ['video/mp4', 'video/avi', 'video/quicktime', 'video/x-ms-wmv'];
            if (!allowedTypes.includes(file.type)) {
                alert('Only MP4, AVI, MOV, and WMV files are allowed');
                e.target.value = '';
                return;
            }
        }
    });
});
</script>
{% endblock %}